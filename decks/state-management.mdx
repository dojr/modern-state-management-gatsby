import LiveEdit from '../src/components/LiveEdit'
import { example_1, example_2, example_3, unstated_next_finished, immer_example_scope } from '../src/Examples'
const code = `
    return (
            <ApolloProvider client={client}>
                <AuthProvider>
                    <DimensionsProvider>
                        <MetadataRealmProvider>
                            <LearnerRealmProvider>
                                <DownloadTaskProvider>
                                    <CacheProvider>
                                        <ThemeProvider theme={Theme}>
                                            <EditProvider>
                                                <NavigationContainer>
                                                    <FeedbackProvider>
                                                        <AppProvider />
                                                    </FeedbackProvider>
                                                </NavigationContainer>
                                            </EditProvider>
                                        </ThemeProvider>
                                    </CacheProvider>
                                </DownloadTaskProvider>
                            </LearnerRealmProvider>
                        </MetadataRealmProvider>
                    </DimensionsProvider>
                </AuthProvider>
            </ApolloProvider>
        );
`

# Modern State Management (with hooks)

## DJ Shamblin

---

## React Hooks Intro

- add state to functional components
- regular or custom hooks
- co locating code 
- replacing HOCs and reducing "wrapper hell"

---

## Four rules of hooks

- never call hooks from a loop
- never call hooks from a nested functional
- hooks always sit at the top level
- only call from a functional component

---

### npm install eslint-plugin-react-hooks

---

## Modern state management

- local state first then if components need to share state reach for context api

`const [count, setCount] = useState(0)` âœ”

- use context api with `unstated-next` for simpler api

`const { count , setCount } = useCounter()` âœ”

- no need to reach for anything more advanced like redux


---
## Component State rather than global state

- With redux all state is global and accessible to every component ðŸ¤¢

- React hooks and context allows state contained within only the components that need it âœ”

- Components outside that never use this state don't have access to it now âœ”

- Co-locating state with the components that use it and avoid prop drilling at the same time âœ”

---

## Considerations for state

- Some state should be global (auth)

- Most other state could be contained within a separate part of the app

- Context Providers can then be used at the global level or component level

---

## State management without context

<LiveEdit noInline={true} code={example_1} />

---

### [Using React Context API Effectively](https://kentcdodds.com/blog/how-to-use-react-context-effectively) - Kent Dodds

## Hooks state with Context API

<LiveEdit noInline={true} code={example_2} />

---

## [unstated-next](https://github.com/jamiebuilds/unstated-next)


200 bytes to never think about React state management libraries ever again

---

### Some downsides to unstated-next

- Pure react so no additonal debugging functionality like with redux
- "Provider hell"
- Nested providers can use parent providers so re-ordering providers may break things
    - not a problem with global state

<pre>    
    {code}
</pre>

---

## Hooks State with unstated-next

<LiveEdit noInline={true} code={example_3} />


---

### Other state libraries and Redux
- Redux
  -   [redux-toolkit](https://github.com/reduxjs/redux-toolkit)
      - defacto library for redux in react 
  - [easy-peasy](https://github.com/ctrlplusb/easy-peasy#readme)
- Mobx 
   - [Mobx with hooks](https://www.youtube.com/watch?v=pnhIJA64ByY&feature=youtu.be)
- Other libraries
  - [react-easy-state](https://github.com/RisingStack/react-easy-state)
  - [reusable](https://github.com/reusablejs/reusable)
---


### [Immer](https://github.com/immerjs/immer)

- handles complex state easily

- create immutable state by mutating current state

- `useImmer` hook inside containers instead of `useState`

- use cases include nested state or objects

---

### useImmer example

<LiveEdit noInline={true} code={unstated_next_finished} scope={immer_example_scope}/>

---

### CBT Examples

- client-apps-learner
  - [Containers](https://github.com/cbtnuggets/client-apps-learner/tree/master/react-native/state/containers)
- Quiz
  - [Container](https://github.com/cbtnuggets/client-apps-learner/blob/master/react-native/components/Quiz/state/QuizContainer.tsx)
  - [Example usage](https://github.com/cbtnuggets/client-apps-learner/blob/master/react-native/components/Quiz/components/QuizQuestion.tsx)
- [Auth](https://github.com/cbtnuggets/lib-react-custom-hooks/blob/use-auth-hook/examples/src/lib/useAuth/index.tsx)
- Bounty
  - [State containers](https://github.com/cbtnuggets/static-dashboard/tree/update-bounty-board/src/apps/bountyBoard/state)

---

# Questions?